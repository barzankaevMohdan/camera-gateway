# Camera Gateway Service

–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å IP-–∫–∞–º–µ—Ä–∞–º–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–æ–≤.

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Camera Gateway –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ IP-–∫–∞–º–µ—Ä–∞–º –ø–æ RTSP
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è RTSP ‚Üí MJPEG –¥–ª—è –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞–º–∏
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞–º–µ—Ä
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Node.js 18+** - Runtime
- **TypeScript** - –¢–∏–ø–∏–∑–∞—Ü–∏—è
- **Express.js** - Web framework
- **FFmpeg** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ
- **Prisma ORM** - Database access
- **PostgreSQL** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (read-only)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
camera-gateway/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/              # API —Ä–æ—É—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ streams.ts       # MJPEG —Å—Ç—Ä–∏–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cameras.ts       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ diagnostics.ts   # –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ streamManager.ts # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cameraService.ts # –†–∞–±–æ—Ç–∞ —Å –∫–∞–º–µ—Ä–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma        # –ö–æ–ø–∏—è —Å—Ö–µ–º—ã –∏–∑ backend
‚îî‚îÄ‚îÄ package.json
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–°–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:
- [macOS](./SETUP_MACOS.md)
- [Windows](./SETUP_WINDOWS.md)

## üìö API Endpoints

### –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∏
- `GET /streams/:cameraId.mjpg` - MJPEG –ø–æ—Ç–æ–∫ —Å –∫–∞–º–µ—Ä—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- `GET /cameras/:id/test` - –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–∞–º–µ—Ä–µ
- `GET /diagnostics` - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö –∫–∞–º–µ—Ä
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

## üé• –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–∞–º–µ—Ä—ã

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:
- ‚úÖ **Hikvision** (RTSP –ø—É—Ç—å: `/ISAPI/Streaming/Channels/101`)
- ‚úÖ **Dahua** (RTSP –ø—É—Ç—å: `/cam/realmonitor?channel=1&subtype=0`)

### –î–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å:
- –õ—é–±—ã–µ IP-–∫–∞–º–µ—Ä—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π RTSP
- –ö–∞–º–µ—Ä—ã —Å H.264/H.265 –∫–æ–¥–µ–∫–∞–º–∏

### –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:
- ‚ùå USB –∫–∞–º–µ—Ä—ã (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞)
- ‚ùå –ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```env
PORT=4000
FFMPEG_PATH=ffmpeg
DATABASE_URL=postgresql://...
ENCRYPTION_KEY=your-32-character-key
```

### FFmpeg –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```javascript
// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
-rtsp_transport tcp     // –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
-fflags nobuffer       // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
-flags low_delay       // –ù–∏–∑–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
-probesize 32          // –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**Backend:** –ü–æ–ª—É—á–∞–µ—Ç URL —Å—Ç—Ä–∏–º–æ–≤ —á–µ—Ä–µ–∑ API
**Recognition Service:** –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MJPEG –ø–æ—Ç–æ–∫–∞–º –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
**Frontend:** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ `<img src="/streams/1.mjpg">`

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** ~200-500ms
- **–ë–∏—Ç—Ä–µ–π—Ç:** 500-1500 Kbps (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –∫–∞–º–µ—Ä—ã)
- **FPS:** 15-25 (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π FPS –∫–∞–º–µ—Ä—ã)
- **–ú–∞–∫—Å –∫–∞–º–µ—Ä:** ~10-20 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–º–µ—Ä —à–∏—Ñ—Ä—É—é—Ç—Å—è AES-256
- RTSP –ø–∞—Ä–æ–ª–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ plain text
- –î–æ—Å—Ç—É–ø –∫ –ø–æ—Ç–æ–∫–∞–º —á–µ—Ä–µ–∑ Backend (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å JWT)

---

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ [SETUP_MACOS.md](./SETUP_MACOS.md) –∏–ª–∏ [SETUP_WINDOWS.md](./SETUP_WINDOWS.md)
